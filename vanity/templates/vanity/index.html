<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>BTC Vanity Address Generator</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f8f9fa;
      padding: 35px;
    }
    #spinner {
      display: none;
      font-size: 18px;
      margin-top: 15px;
      font-weight: bold;
    }
    code {
      background: #eee;
      padding: 4px 6px;
      border-radius: 4px;
    }
  </style>
</head>

<body>

<div class="container">
  <h1 class="mb-4">BTC Vanity Address Generator</h1>

  <div class="alert alert-warning">
  <b>IMPORTANT:</b> This tool uses Legacy (1...) and P2SH (3...) modes to generate matching Bitcoin vanity addresses.
  The search process is CPU-intensive and may use significant device power while running.<br><br>

  <b>Tips:</b> For best results use short prefixes/suffixes (3–4 characters).
  Use just either only a prefix or a suffix at a time for faster matching.
  If no match is found, adjust your characters and try again.<br><br>

  <b>Security Notice:</b> Never share your private key. Store it securely.
  Anyone with the private key can control the funds. This tool does not hold or save
    users generated private keys
</div>

  <form id="genForm">

    <div class="mb-3">
      <label class="form-label">Prefix (optional)</label>
      <input class="form-control" name="prefix" placeholder="Example: 1BRI">
    </div>

    <div class="mb-3">
      <label class="form-label">Suffix (optional)</label>
      <input class="form-control" name="suffix" placeholder="Example: 007">
    </div>

    <button type="button" id="generateBtn" class="btn btn-primary">Generate</button>
    <button type="button" id="stopBtn" class="btn btn-danger ms-2" disabled>Stop</button>

  </form>

  <div id="spinner" class="text-primary">
    <div class="spinner-border spinner-border-sm me-2"></div>
    Generating BTC address... please wait
  </div>

  <div id="result" class="mt-4"></div>

</div>

<script>
function copyText(id) {
  const text = document.getElementById(id).textContent;
  navigator.clipboard.writeText(text);
  alert("Copied!");
}

document.getElementById("generateBtn").onclick = async function () {
  const btn = document.getElementById("generateBtn");
  const stop = document.getElementById("stopBtn");
  const spin = document.getElementById("spinner");
  const result = document.getElementById("result");

  result.innerHTML = "";
  spin.style.display = "block";
  btn.disabled = true;
  stop.disabled = false;

  const formData = new FormData(document.getElementById("genForm"));

  const res = await fetch("/generate/", {
    method: "POST",
    body: formData
  });

  const j = await res.json();

  spin.style.display = "none";
  btn.disabled = false;
  stop.disabled = true;

  // User pressed STOP
  if (j.stopped) {
    result.innerHTML = `
      <div class="alert alert-info">
        ❗Generation stopped by user.<br>
        Tries: ${j.tries}<br>
        Time: ${j.time?.toFixed(2)}s
      </div>
    `;
    return;
  }

  // Error message
  if (j.error) {
    result.innerHTML = `
      <div class="alert alert-danger">
        ${j.error}
      </div>
    `;
    return;
  }

  // Success
  result.innerHTML = `
    <div class="card p-3">
      <h5 class="mb-3">Generated Address</h5>

      <p><b>Address</b><br>
      <code id="addr">${j.address}</code>
      <button class="btn btn-outline-secondary btn-sm" onclick="copyText('addr')">Copy</button></p>

      <p><b>Private Key (WIF)</b><br>
      <code id="pk">${j.private_key}</code>
      <button class="btn btn-outline-secondary btn-sm" onclick="copyText('pk')">Copy</button></p>

      <p>Tries: ${j.tries}<br>
      Time: ${j.time.toFixed(2)}s</p>
    </div>
  `;
};

// ✅ FIXED STOP BUTTON — now updates UI immediately
document.getElementById("stopBtn").onclick = async function () {
  const stop = document.getElementById("stopBtn");
  const spin = document.getElementById("spinner");
  const result = document.getElementById("result");

  stop.disabled = true;
  spin.style.display = "none";

  const res = await fetch("/stop/", { method: "POST" });
  const j = await res.json().catch(() => ({}));

  result.innerHTML = `
    <div class="alert alert-info">
      ⛔ Generation stopped.<br>
      ${j.tries ? "Tries: " + j.tries + "<br>" : ""}
      ${j.time ? "Time: " + j.time.toFixed(2) + "s" : ""}
    </div>
  `;
};
</script>

</body>
</html>